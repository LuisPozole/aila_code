  GNU nano 7.2                                                                                                                                                                                                                                                                                                                                                                                index.js                                                                                                                                                                                                                                                                                                                                                                                         
const express = require('express');
const { Client, LocalAuth } = require('whatsapp-web.js');
const qrcode = require('qrcode-terminal');
const cors = require('cors');

const app = express();
const port = 3000;

app.use(express.json());
app.use(cors());

// Inicializar el cliente de WhatsApp Web con autenticaciÃ³n local
const client = new Client({
    authStrategy: new LocalAuth()
});

// Mostrar el cÃ³digo QR en la terminal
client.on('qr', qr => {
    console.log('ðŸ“± Escanea este cÃ³digo QR para conectar WhatsApp:');
    qrcode.generate(qr, { small: true });
});

client.on('ready', () => {
    console.log('âœ… Conectado a WhatsApp');
});

// Endpoint para enviar mensajes a WhatsApp
app.post('/enviar-mensaje', async (req, res) => {
    const { numero, mensaje } = req.body;
    const chatId = `${numero}@c.us`;
    
    try {
        const isRegistered = await client.isRegisteredUser(chatId);
        if (!isRegistered) {
            return res.status(400).json({ error: 'El nÃºmero no estÃ¡ registrado en WhatsApp' });
        }

        await client.sendMessage(chatId, mensaje);
        console.log(`ðŸš€ Mensaje enviado a ${numero}: ${mensaje}`);
        res.json({ success: true, message: 'Mensaje enviado correctamente' });
    } catch (error) {
        console.error('âŒ Error enviando mensaje:', error);
        res.status(500).json({ error: 'Error al enviar mensaje' });
    }
});

// Iniciar el servidor Express
app.listen(port, () => {
    console.log(`ðŸš€ Servidor corriendo en http://localhost:${port}`);
});

// Inicializar WhatsApp
client.initialize();



